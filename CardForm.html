<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Add Trading Card</title>
  <link rel="stylesheet" href="FormStyles.css">
</head>
<body>
  <div class="form-container">
    <h2>Add a Trading Card</h2>
    <form id="cardForm" enctype="multipart/form-data">
      <label for="cardName">Card Name:</label>
      <input type="text" id="cardName" name="cardName" required>

      <label for="description">Description:</label>
      <textarea id="description" name="description" rows="4"></textarea>

      <label for="rarity">Rarity:</label>
<select id="rarity" name="rarity" required>
  <option value="">--Select Rarity--</option>
  <option value="CM">Common</option>
  <option value="UC">Uncommon</option>
  <option value="RR">Rare</option>
  <option value="HR">Holo Rare</option>
  <option value="UR">Ultra Rare</option>
  <option value="SR">Secret Rare</option>
</select>


      <label for="cardPrice">Price ($):</label>
      <input type="number" step="0.01" id="cardPrice" name="cardPrice" required>

      <label for="setName">Set Name:</label>
      <input type="text" id="setName" name="setName">

      <label for="imgUrl">Card Image:</label>
      <input type="file" id="imgUrl" name="imgUrl" accept="image/*">

      <input type="submit" value="Add Card">
    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const SUPABASE_URL = 'https://nuivtmqkqxmritchchxj.supabase.co';
  const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im51aXZ0bXFrcXhtcml0Y2hjaHhqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA4OTY1MjMsImV4cCI6MjA2NjQ3MjUyM30.cTgFkrqoJeNzmyggNZ8mf-gXcZu7xl-J8rYGXPyDGoA';
  const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  document.getElementById("cardForm").addEventListener("submit", async function(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);

    const cardData = {
      card_name: formData.get("cardName"),
      description: formData.get("description"),
      rarity: formData.get("rarity"), // should be 2-letter code
      card_price: parseFloat(formData.get("cardPrice")),
      set_name: formData.get("setName"),
      //img_url: null // will be set after upload
    };

    //need to update supabase permission or add auth capabilitiews to store images in buckets
    /*const file = formData.get("imgUrl");
    if (file && file.size > 0) {
      const { data: uploadData, error: uploadError } = await supabaseClient
        .storage
        .from('card-images')
        .upload(`cards/${Date.now()}_${file.name}`, file);

      if (uploadError) {
        console.error('Image upload failed:', uploadError.message);
        return;
      }

      const { data: publicUrlData } = supabaseClient
        .storage
        .from('card-images')
        .getPublicUrl(uploadData.path);

      cardData.img_url = publicUrlData.publicUrl;
    }*/

    const { data, error } = await supabaseClient
      .from('cards')
      .insert([cardData]);

    if (error) {
      console.error('Error inserting card:', error.message);
      alert("Error: " + error.message);
    } else {
      alert('Card added successfully!');
      form.reset();
    }
  });
</script>

  
</body>
</html>
